<style>
  @import url("./style.css");
</style>

<script type="importmap">
  {
    "imports": {
      "three": "https://cdn.jsdelivr.net/npm/three@0.141.0/build/three.module.js",
      "three/addons/": "https://cdn.jsdelivr.net/npm/three@0.141.0/examples/jsm/"
    }
  }
</script>

<t-renderer orbit>
  <t-studio></t-studio>
  <t-raycaster></t-raycaster>
  <t-crate position="2,0,0"></t-crate>
  <t-crate></t-crate>
</t-renderer>

<script type="module">
  import "../three-webc.js";
  import * as THREE from "three";
  import { createCrate } from "./addons/crate.js";
  import "./addons/studio.js";
  import * as EFFECTS from "./addons/effects.js";
  import { TWEEN } from "three/addons/libs/tween.module.min.js";

  const { scene } = document.querySelector("t-renderer");

  const raycaster = document.querySelector("t-raycaster");

  const tRenderer = document.querySelector("t-renderer");
  tRenderer.renderer.domElement.addEventListener("click", (e) => {
    const intersects= raycaster.cast();
    const object = intersects.length && intersects[0].object
    if(object) {
      EFFECTS.bounce(object);
    }
  });
  tRenderer.renderer.domElement.addEventListener("contextmenu", (e) => {
    const intersects = raycaster.cast();
    const object = intersects.length && intersects[0].object
    if(object) {
      EFFECTS.remove(object);
      // first.removeFromParent()
    }
  });

  document.querySelector("t-renderer").viewport.rafs.push(() => {
    TWEEN.update();
  });

  const app = {
    scene,
    _scene: null,
    reset() {
      const copy = app._scene.clone()
      tRenderer.scene.children = copy.children
    }
  }
  window.app = app
  setTimeout(() => {
    app._scene = scene.clone()
  })

  {
    const { GUI } = await import(
      "https://cdn.jsdelivr.net/npm/lil-gui@0.17/+esm"
    );
    const gui = new GUI();

    const raycaster = document.querySelector("t-raycaster");
    const folder = gui //.addFolder("Raycaster"); //.open(false);
    folder.domElement.append(document.createTextNode('click left for bounce or right to remove a box'))
    folder.add(raycaster.state.pointer, "x").listen();
    folder.add(raycaster.state.pointer, "y").listen();
    folder.add(app, "reset")
  }
</script>
